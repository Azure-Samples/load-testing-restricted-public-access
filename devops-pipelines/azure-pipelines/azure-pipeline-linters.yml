---
pool:
  vmImage: ubuntu-latest

stages:
  - stage: LinterStage
    displayName: Linter Stage
    condition: succeeded()
    jobs:
      - job: JobLinter
        displayName: Job Linter
        steps:
          - checkout: self
            lfs: true
          - script: |
              docker run -v $(System.DefaultWorkingDirectory):/tmp/lint \
                -e GIT_AUTHORIZATION_BEARER=$(System.AccessToken) \
                -e CI=true \
                -e TF_BUILD=true \
                -e SYSTEM_ACCESSTOKEN=$(System.AccessToken) \
                -e SYSTEM_COLLECTIONURI=$(System.CollectionUri) \
                -e SYSTEM_PULLREQUEST_PULLREQUESTID=$(System.PullRequest.PullRequestId) \
                -e SYSTEM_TEAMPROJECT="$(System.TeamProject)" \
                -e BUILD_BUILD_ID=$(Build.BuildId) \
                -e BUILD_REPOSITORY_ID=$(Build.Repository.ID) \
                -e SPELL_CSPELL_DISABLE_ERRORS=true \
                -e DISABLE_LINTERS="REPOSITORY_TRIVY,COPYPASTE_JSCPD,JSON_V8R,REPOSITORY_CHECKOV," \
                oxsecurity/megalinter:v6
            displayName: Run MegaLinter
